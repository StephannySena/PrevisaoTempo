<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Previsão do Tempo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">

</head>

<body class="bg-info p-2 text-dark bg-opacity-10">
    <header>
        <div class="text-center m-3 p-3">
            <h2 class="text-center">Previsão do Tempo</h2>

        </div>
    </header>

    <main>
        <div class="row justify-content-center">
            <input type="text" id="idCidade" placeholder="Cidade" class="col-sm-3 border rounded border-dark m-2 p-2">
            <input type="text" id="idDias" placeholder="Qnt. dias de previsão"
                class="col-sm-2 border rounded border-dark m-2 p-2">
            <input type="button" id="btnPesquisar" value="Pesquisar"
                class="col-sm-1 btn btn-info btn-sm border rounded border-dark">
        </div>


        <div class="row justify-content-center">
            
            
            <p id="idLocal" class="border rounded border-dark m-2 p-2 bg-light row justify-content-md-center"></p>
                
            <div id="idDia0" class="col-md-3 border rounded border-dark m-2 p-2 bg-light">
                <img src="" alt="" id="idImgDia0">

            </div>

            <div id="idDia1" class="col-md-3 border rounded border-dark m-2 p-2 bg-light">
                <img src="" alt="" id="idImgDia1">

            </div>

            <div id="idDia2" class="col-md-3 border rounded border-dark m-2 p-2 bg-light">
                <img src="" alt="" id="idImgDia2">

            </div>


        </div>

    </main>

    <footer></footer>

    <script>

        var cidade
        var dias
        var tempMin = []
        var tempMax = []
        var condicaoTempo = []
        var imgTempo = []



        var btnPesquisar = document.getElementById("btnPesquisar")
        btnPesquisar.onclick = function () {
            dias = Number(document.getElementById("idDias").value)
            pegarPrevisao(dias)
        }



        function pegarPrevisao(dias) {
            cidade = document.getElementById("idCidade").value
            fetch("https://weatherapi-com.p.rapidapi.com/forecast.json?q=" + cidade + "&days=3&lang=pt&dt=", {
                "method": "GET",
                "headers": {
                    "x-rapidapi-host": "weatherapi-com.p.rapidapi.com",
                    "x-rapidapi-key": "b329e6dadamshacd6405a7a4465fp1e0c6bjsn48d9b278ba9d"
                }
            })
                .then(response => {
                    return response.json();
                })
                .then(previsao => {
                    console.log(previsao);

                    for (let i = 0; i < dias; i++) {
                        tempMin.push(previsao.forecast.forecastday[i].day.mintemp_c)
                        tempMax.push(previsao.forecast.forecastday[i].day.maxtemp_c)
                        condicaoTempo.push(previsao.forecast.forecastday[i].day.condition.text)
                        imgTempo.push(previsao.forecast.forecastday[i].day.condition.icon)

                    }
                    console.log(tempMin);

                    return tempMin, tempMax, condicaoTempo, imgTempo
                })
                .then(() => {
                    for (let i = 0; i < dias; i++)
                        mostrarPrevisao(i)

                })
                .catch(err => {
                    console.error(err);
                });

        }

        function mostrarPrevisao(index) {

            document.getElementById("idLocal").innerHTML = cidade

            let dia = document.getElementById("idDia" + index)
            dia.appendChild(montaDia(condicaoTempo[index]))
            dia.appendChild(montaDia("Mín.: " + tempMin[index] + "ºC" + " -  Máx.: " + tempMax[index] + "ºC"))
            document.getElementById("idImgDia" + index).src = "https:" + imgTempo[index]


        }

        function montaDia(dado) {
            let prevDia = document.createElement("p")
            prevDia.textContent = dado
            return prevDia

        }

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj"
        crossorigin="anonymous"></script>

</body>

</html>